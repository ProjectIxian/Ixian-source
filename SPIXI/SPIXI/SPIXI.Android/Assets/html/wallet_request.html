<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>SPIXI Wallet</title>
    <link rel="stylesheet" type="text/css" href="css/normalize.css">
    <link rel="stylesheet" type="text/css" href="css/bootstrap37.css">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link rel="stylesheet" type="text/css" href="css/stylewallet.css">
    <link rel="stylesheet" type="text/css" href="css/styleaddress.css">

    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/qrcode.min.js"></script>
    <script src="js/clipboard.min.js"></script>    
	<script src="js/spixi.js"></script>
</head>
    
<body onload="onload()">
<div id="wrap" class="container-fluid noselect">
    
    <div id="toolbar" class="toolbar">
        <div id="backbtn" class="toolbar_back"></div>
        <div class="toolbar_text" id="title">Request IXI</div>
    </div>
    <div class="toolbarholder">
    </div>
    
    <div id="req_from" style="display:none;">
        <div class="wallet_subtitle">Payment will be requested from</div>
        <div class="wallet_from_holder">
            <div class="col-xs-2 wallet_from_avatar"><img src="avatar.png" style="width:48px;height:48px;border-radius: 48px;" /></div>
            <div id="contact_wallet_address" class="col-xs-10 wallet_from_text"></div>
        </div>
        <hr class="wallet_hr" />
    </div>

    <div>
        <div class="wallet_subtitle">Request specific amount</div>

        <div class="wallet_amount">
            <input type="number" id="wallet_amount_input" onkeyup="generateQR()" placeholder="0.0000" pattern="[0-9]*">
        </div>
        <div class="wallet_amount_info">Tap to generate an address for a specific amount</div>
        <hr class="wallet_hr2" />
    </div>
    
    <div class="address_qr_holder" data-clipboard-text="SPIXI RULES">
        <div class="wallet_qr" id="qrcode"></div>
            
            <div class="wallet_subtitle">Current address</div>

            <div id="wal1" class="address_text">Generating</div>
            <div id="wal2" class="address_text">your SPIXI</div>
            <div id="wal3" class="address_text">address...</div>
            <hr class="address_hr" />
            <div class="address_info"> Tap to copy to clipboard</div>

            <div id="toastbar">Address copied to clipboard</div>
    </div>

    
    <div id="toastbar">Address copied to clipboard</div>
    
    <div id="sendr" class="button" style="margin-top: 20px; margin-bottom:40px; display:none;">Send payment request</div>

</div>

<script type="text/javascript">
    
    document.getElementById("backbtn").onclick = function() {
        location.href = "ixian:back";
    } 
    
    document.getElementById("sendr").onclick = function() {
        var amount = document.getElementById("wallet_amount_input").value;
        if (isBlank(amount)) {
            location.href = "ixian:error";
            return;
        }
        location.href = "ixian:request:" +  amount;
    }

    var wal_id = "";

    var clipboard = new ClipboardJS('.address_qr_holder', {
                text: function() {
                    return wal_id;
                }});

            clipboard.on('success', function(e) {
                e.clearSelection();
                
                var x = document.getElementById("toastbar");
                x.className = "show";
                setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000);

            });

            clipboard.on('error', function(e) {

    });
    
    var qrcode = new QRCode("qrcode", {
        text: "SPIXI",
        width: 300,
        height: 300,
        colorDark: "#000000",
        colorLight: "#ffffff",
        correctLevel: QRCode.CorrectLevel.H
    });

    function setAddress(addr) {
        wal_id = addr;
        generateQR();
        var parts = addr.match(/.{1,17}/g) || [];
        document.getElementById("wal1").innerHTML = parts[0];
        document.getElementById("wal2").innerHTML = parts[1];
        document.getElementById("wal3").innerHTML = parts[2];
    }

    function generateQR() {
        var amount = document.getElementById("wallet_amount_input").value;
        qrcode.clear(); // clear the code.
        qrcode.makeCode(wal_id + ":send:" + amount);

    }

    // Hide the request from part and the send request button
    function showRequest() {
        document.getElementById("req_from").style.display = "block";
        document.getElementById("sendr").style.display = "block";

    }

    function setContactAddress(address, nick) {
        showRequest();
        document.getElementById("contact_wallet_address").innerHTML = "<b>"+nick+"</b><br />"+address;
    }

    function isBlank(str) {
        return (!str || /^\s*$/.test(str));
    }

</script>
    
</body>    
</html>